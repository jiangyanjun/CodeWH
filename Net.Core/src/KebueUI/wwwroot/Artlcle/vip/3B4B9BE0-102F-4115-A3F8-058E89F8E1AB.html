<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="Language" content="zh-CN">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../images/kebue.ico">
    <link rel="icon" href="../../images/kebue.ico">
    <meta name="description" content=监控oracle性能的一些常用查询>
    <meta name="keywords" content=监控oracle性能的一些常用查询1.查看临时表空间使用情况Selectf.tablespace_name,sum(f.bytes_free + f.bytes_used)/1024/1024/1024 total GB,sum((f.bytes_free + f.bytes_used) - nvl(p.bytes_used, 0))/1024/1024/1024 Free GB,sum(nvl(>
    <title>监控oracle性能的一些常用查询</title>

    <link href="../../template/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../template/styles/custom.css" rel="stylesheet" />
</head>
<body id="pageBody">
    <div id="divBoxed" class="container">
        <div class="transparent-bg" style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index: -1;zoom: 1;"></div>
        <div class="divPanel notop nobottom">
            <div class="row-fluid">
                <div class="span12">
                    <div id="divLogo">
                        <a href="../../../Home/Index" id="divSiteTitle">科布尔 kebue</a><br />
                        <a href="../../../Home/Index" id="divTagLine">开发者用代码改变世界从科布尔开始</a>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="divMenuRight" class="pull-right">
                        <div class="navbar">
                            <button type="button" class="btn btn-navbar-highlight btn-large btn-primary" data-toggle="collapse" data-target=".nav-collapse">
                                NAVIGATION <span class="icon-chevron-down icon-white"></span>
                            </button>
                            <div class="nav-collapse collapse">
                                <ul class="nav nav-pills ddmenu">
                                    <li class="dropdown glyphicon glyphicon-arrow-left"><a href='javascript:window.history.back()'>后退</a></li>
                                    <li class="dropdown active"><a href="http://www.kebue.com/">Home</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="contentInnerSeparator"></div>
                </div>
            </div>
        </div>
        <div class="contentArea">
            <div class="divPanel notop page-content">
                <div class="breadcrumbs">
                    <a href="../../../Home/Index">Home</a> &nbsp;/&nbsp; <span><a href='../../../../../Artlcle/ArticleType/0D8667FF-B247-4368-A163-B9D7274FE236.html' title='Oracle'>Oracle</a></span>
                </div>
                <div class="row-fluid">
                    <div class="span12" id="divMain">
                        <h1>监控oracle性能的一些常用查询</h1>
                        <pre>
                        <code>
                            <p><a href="file:///C:/12478376/viewspace-1084693/" style="background-color: inherit; cursor: pointer;">监控oracle性能的一些常用查询</a></p><p style="background-color: inherit;"><br/></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">1.</span>查看临时表空间使用情况</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">Select</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">f.tablespace_name</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">,sum(f.bytes_free + f.bytes_used)</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">/1024/1024/1024 &quot;total GB&quot;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">,sum((f.bytes_free + f.bytes_used) - nvl(p.bytes_used, 0))</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">/1024/1024/1024 &quot;Free GB&quot;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">,sum(nvl(p.bytes_used, 0))</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">/1024/1024/1024 &quot;Used GB&quot;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">from sys.v_$temp_space_header f, dba_temp_files d, sys.v_$temp_extent_pool p</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">where f.tablespace_name(+) = d.tablespace_name</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">and f.file_id(+) = d.file_id</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">and p.file_id(+) = d.file_id</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">group by</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">f.tablespace_name</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">2.</span>查看使用临时表空间的<span lang="EN-US" style="background-color: inherit;">SQL</span></h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">Select se.username,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; se.sid,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;su.extents,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; su.blocks * to_number(rtrim(p.value)) as Space,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tablespace,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; segtype,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql_text</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp; from v$sort_usage su, v$parameter p, v$session se, v$sql s</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;where p.name = &#39;db_block_size&#39;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp; and su.session_addr = se.saddr</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp; and s.hash_value = su.sqlhash</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp; and s.address = su.sqladdr</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;order by se.username, se.sid</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">3.</span>收缩临时表空间</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">alter tablespace temp shrink space;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">alter tablespace temp shrink tempfile &#39;&#39;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">4.</span>重建索引</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">alter index PK_CROSSRELATION rebuild;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">5.</span>查看表空间使用情况</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">SELECT UPPER(F.TABLESPACE_NAME) &quot;</span>表空间名<span lang="EN-US" style="background-color: inherit;">&quot;,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">D.TOT_GROOTTE_MB &quot;</span>表空间大小<span lang="EN-US" style="background-color: inherit;">(M)&quot;,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">D.TOT_GROOTTE_MB - F.TOTAL_BYTES &quot;</span>已使用空间<span lang="EN-US" style="background-color: inherit;">(M)&quot;,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,2),&#39;990.99&#39;) || &#39;%&#39; &quot;</span>使用比<span lang="EN-US" style="background-color: inherit;">&quot;,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">F.TOTAL_BYTES &quot;</span>空闲空间<span lang="EN-US" style="background-color: inherit;">(M)&quot;,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">F.MAX_BYTES &quot;</span>最大块<span lang="EN-US" style="background-color: inherit;">(M)&quot;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">FROM (SELECT TABLESPACE_NAME,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">FROM SYS.DBA_FREE_SPACE</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">GROUP BY TABLESPACE_NAME) F,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">(SELECT DD.TABLESPACE_NAME,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">FROM SYS.DBA_DATA_FILES DD</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">GROUP BY DD.TABLESPACE_NAME) D</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">ORDER BY 1;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">6.</span>查询表空间的总容量</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">select tablespace_name, sum(bytes) / 1024 / 1024 as MB</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">from dba_data_files</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">group by tablespace_name;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">7.&nbsp;</span>查询表空间使用率</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">select total.tablespace_name,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">round(total.MB, 2) as Total_MB,</span>考试大论坛</p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">round(total.MB - free.MB, 2) as Used_MB,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">round((1 - free.MB / total.MB) * 100, 2) || &#39;%&#39; as Used_Pct</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">from (select tablespace_name, sum(bytes) / 1024 / 1024 as MB</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">from dba_free_space</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">group by tablespace_name) free,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">(select tablespace_name, sum(bytes) / 1024 / 1024 as MB</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">from dba_data_files</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">group by tablespace_name) total</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">where free.tablespace_name = total.tablespace_name;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">8.&nbsp;</span>查找当前表级锁的<span lang="EN-US" style="background-color: inherit;">SQL</span>如下：</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">select sess.sid,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; sess.serial#,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; lo.oracle_username,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; lo.os_user_name,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; ao.object_name,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; lo.locked_mode</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; from v$locked_object lo,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; dba_objects ao,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; v$session sess</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; where ao.object_id = lo.object_id and lo.session_id = sess.sid;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>杀掉锁表进程：</p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; alter system kill session &#39;436,35123&#39;;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">9.</span>监控当前数据库谁在运行什么<span lang="EN-US" style="background-color: inherit;">SQL</span>语句</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">select osuser, username, sql_text&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">from&nbsp; v$session a, v$sqltext b</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">where&nbsp; a.sql_address =b.address order by address, piece;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">10.</span>找使用<span lang="EN-US" style="background-color: inherit;">CPU</span>多的用户<span lang="EN-US" style="background-color: inherit;">session</span></h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; select a.sid,spid,status,substr(a.program,1,40) prog, a.terminal,osuser,value/60/100 value</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; from&nbsp; v$session a,v$process b,v$sesstat c</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; where&nbsp; c.statistic#=12 and&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.sid=a.sid and&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a.paddr=b.addr&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; order by value desc;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">11.</span>查看死锁信息</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">SELECT (SELECT username</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM v$session</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE SID = a.SID) blocker, a.SID, &#39;is blocking&#39;,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (SELECT username</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FROM v$session</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHERE SID = b.SID) blockee, b.SID</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp; FROM v$lock a, v$lock b</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;WHERE a.BLOCK = 1 AND b.request &gt; 0 AND a.id1 = b.id1 AND a.id2 = b.id2;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">12.</span>具有最高等待的对象</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">SELECT&nbsp;&nbsp; o.OWNER,o.object_name, o.object_type, a.event,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM (a.wait_time + a.time_waited) total_wait_time</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; FROM v$active_session_history a, dba_objects o</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp; WHERE a.sample_time BETWEEN SYSDATE - 30 / 2880 AND SYSDATE</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp; AND a.current_obj# = o.object_id</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">GROUP BY o.OWNER,o.object_name, o.object_type, a.event</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">ORDER BY total_wait_time DESC;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">13.</span>查看具有最高等待的对象</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">SELECT&nbsp;&nbsp; a.session_id, s.osuser, s.machine, s.program, o.owner, o.object_name,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.object_type, a.event,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM (a.wait_time + a.time_waited) total_wait_time</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; FROM v$active_session_history a, dba_objects o, v$session s</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp; WHERE a.sample_time BETWEEN SYSDATE - 30 / 2880 AND SYSDATE</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp; AND a.current_obj# = o.object_id</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp; AND a.session_id = s.SID</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">GROUP BY o.owner,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.object_name,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o.object_type,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a.event,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a.session_id,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s.program,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s.machine,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s.osuser</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">ORDER BY total_wait_time DESC;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">14.</span>查看等待最多的<span lang="EN-US" style="background-color: inherit;">SQL</span></h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">SELECT&nbsp;&nbsp; a.program, a.session_id, a.user_id, d.username, s.sql_text,</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUM (a.wait_time + a.time_waited) total_wait_time</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp; FROM v$active_session_history a, v$sqlarea s, dba_users d</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp; WHERE a.sample_time BETWEEN SYSDATE - 30 / 2880 AND SYSDATE</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp; AND a.sql_id = s.sql_id</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp;&nbsp;&nbsp; AND a.user_id = d.user_id</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">GROUP BY a.program, a.session_id, a.user_id, s.sql_text, d.username;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><h1 style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">15.</span>显示正在等待锁的所有会话</h1><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;</span></p><p style="background-color: inherit;"><span lang="EN-US" style="background-color: inherit;">&nbsp;&nbsp; SELECT * FROM DBA_WAITERS</span></p><p><span lang="EN-US" style="background-color: inherit;"><br/></span></p><p><br/></p>
                        </code>
                        </pre>
                        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
                        <!-- UY BEGIN -->
                        <div id="uyan_frame"></div>
                        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2113268"></script>
                        <!-- UY END -->
                    </div>
                </div>
                <div id="footerInnerSeparator"></div>
            </div>
        </div>
        <div id="footerOuterSeparator"></div>
    </div>
    <br /><br /><br />
    <script src="../../js/jquery-1.9.1.js"></script>
    <script>
        window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": $("#divMain pre code").text(), "bdMini": "2", "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {}, "image": { "viewList": ["qzone", "tsina", "tqq", "renren", "weixin"], "viewText": "分享到：", "viewSize": "16" }, "selectShare": { "bdContainerClass": null, "bdSelectMiniList": ["qzone", "tsina", "tqq", "renren", "weixin"] } }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];
    </script>
</body>
</html>