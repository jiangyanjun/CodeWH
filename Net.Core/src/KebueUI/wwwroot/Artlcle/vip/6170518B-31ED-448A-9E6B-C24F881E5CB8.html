<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="Language" content="zh-CN">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../images/kebue.ico">
    <link rel="icon" href="../../images/kebue.ico">
    <meta name="description" content=Java GC - 监控回收行为与日志分析>
    <meta name="keywords" content=1. 简介  在上一篇介绍Java GC - 垃圾回收机制，本文将介绍如何监控 Javc GC 行为，同时涉及一些GUI工具的使用(虽然有些已经很老并不再更新)，监控GC在于判断JVM是否在良好高效地工作并且是否需要投入性能调优(主要包括应用程序优化与JVM参数优化)，关注的数据大概有：  1. Mirror GC频率、持续时间以及回收内存量。  2. Major GC频率、持续时间、回收内存量以>
    <title>Java GC - 监控回收行为与日志分析</title>

    <link href="../../template/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../template/styles/custom.css" rel="stylesheet" />
</head>
<body id="pageBody">
    <div id="divBoxed" class="container">
        <div class="transparent-bg" style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index: -1;zoom: 1;"></div>
        <div class="divPanel notop nobottom">
            <div class="row-fluid">
                <div class="span12">
                    <div id="divLogo">
                        <a href="../../../Home/Index" id="divSiteTitle">科布尔 kebue</a><br />
                        <a href="../../../Home/Index" id="divTagLine">开发者用代码改变世界从科布尔开始</a>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="divMenuRight" class="pull-right">
                        <div class="navbar">
                            <button type="button" class="btn btn-navbar-highlight btn-large btn-primary" data-toggle="collapse" data-target=".nav-collapse">
                                NAVIGATION <span class="icon-chevron-down icon-white"></span>
                            </button>
                            <div class="nav-collapse collapse">
                                <ul class="nav nav-pills ddmenu">
                                    <li class="dropdown glyphicon glyphicon-arrow-left"><a href='javascript:window.history.back()'>后退</a></li>
                                    <li class="dropdown active"><a href="http://www.kebue.com/">Home</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="contentInnerSeparator"></div>
                </div>
            </div>
        </div>
        <div class="contentArea">
            <div class="divPanel notop page-content">
                <div class="breadcrumbs">
                    <a href="../../../Home/Index">Home</a> &nbsp;/&nbsp; <span><a href='../../../../../Artlcle/ArticleType/921733AE-DBDF-47C6-B557-E47959272851.html' title='JAVA'>JAVA</a></span>
                </div>
                <div class="row-fluid">
                    <div class="span12" id="divMain">
                        <h1>Java GC - 监控回收行为与日志分析</h1>
                        <pre>
                        <code>
                            <p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 18px;"><strong>1. 简介</strong></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 在上一篇介绍&lt;<a title="Java GC - 垃圾回收机制" href="http://www.cnblogs.com/mikevictor07/p/5023776.html" target="_blank" style="color: rgb(29, 88, 209); text-decoration: none;">Java GC - 垃圾回收机制</a>&gt;，&nbsp;本文将介绍如何监控 Javc GC 行为，同时涉及一些GUI工具的使用(虽然有些已经很老并不再更新)，监控GC在于判断JVM是否在良好高效地工作并且是否需要投入性能调优(主要包括应用程序优化与JVM参数优化)，关注的数据大概有：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 1. Mirror GC频率、持续时间以及回收内存量。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 2. Major GC频率、持续时间、回收内存量以及 stop-the-world 耗时。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 3. Heap 对象分配(导出.hprof文件分析，通常比较大)</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 18px;"><strong>2. GC LOG 及Collector行为分析</strong></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; LOG分析包含前面文章所介绍的各个GC collector的行为分析。通过加入&nbsp;-XX:+PrintGCDetails 参数则可以打印详细GC信息至控制台。参数-verbose:gc也是可以，但不够详细。通过加入-XX:+PrintGCDateStamps则可以记录GC发生的详细时间。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">通过加入&nbsp;-Xloggc:/home/XX/gc/app_gc.log 可以把GC输出至文件，这对长时间服务器GC监控很有帮助。以下列出一些参数大致打印的信息如下：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>1.</strong>&nbsp;-verbose:gc：&nbsp;<em>[GC 72104K-&gt;9650K(317952K), 0.0130635 secs]</em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>2.</strong>&nbsp;-XX:+PrintGCDetails:&nbsp;<em>[GC [PSYoungGen: 142826K-&gt;10751K(274944K)] 162800K-&gt;54759K(450048K), 0.0609952 secs] [Times: user=0.13 sys=0.02, real=0.06 secs]</em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>3.</strong>&nbsp;-XX:+PrintGCDetails 加上-XX:+PrintGCDateStamps 参数则打印如下：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;<em>2015-12-06T12:32:02.890+0800: [GC [PSYoungGen: 142833K-&gt;10728K(142848K)] 166113K-&gt;59145K(317952K), 0.0792023 secs] [Times: user=0.22 sys=0.00, real=0.08 secs]&nbsp;</em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">可以看出，如果是想监控详细信息与GC发生时间，加上-XX:+PrintGCDateStamps -XX:+PrintGCDetails 参数会是一个比较好的选择。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>首先来说明一段在各个GC中通用的字段含义说明：</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 102, 0);">1、142826K-&gt;10751K(274944K) 分别代表回收前、回收后以及总内存大小。</span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 102, 0);">2、Times: user=0.46 sys=0.05, real=0.07 secs： &nbsp;user代表GC 需要的各个CPU总时间(各个CPU时间相加)，sys代表回收器自身的行为所占用CPU时间，real则代表本次GC所耗费的真正耗时(在多核CPU中并行回收，它通常小于user) 。</span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>2.1 &nbsp;Serial GC (-XX:+UseSerialGC)</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;下面是一段的Serial GC日志含义依次分解：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">---------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 128, 0);">[GC[DefNew: 78656K-&gt;8704K(78656K), 0.0487492 secs] 135584K-&gt;80553K(253440K), 0.0488309 secs] [Times: user=0.05 sys=0.00, real=0.05 secs]&nbsp;</span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 153, 0);">[Full GC[Tenured: 62546K-&gt;60809K(174784K), 0.1600120 secs] 85931K-&gt;60809K(253440K), [Perm : 38404K-&gt;38404K(65536K)], 0.1600814 secs] [Times: user=0.16 sys=0.00, real=0.16 secs]</span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">---------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">1. 其中的<strong>DefNew</strong>代表单线程回收yong generation。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">2. 紧跟后面的&nbsp;<strong><em>78656K-&gt;8704K(78656K)</em></strong>&nbsp;中的&nbsp;<em>78656K&nbsp;</em>代表young generation 回收前大小，<em>8704K</em>&nbsp;代表回收后大小，括号中的<em>78656K</em>&nbsp;代表young generation总大小(包含2个survivor)。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">3.&nbsp;135584K-&gt;80553K(253440K) 则代表整个Heap(young+old)的变化与总量，含义参照前面所述(Perm也一样)。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">4. Full GC 即代表 major GC,&nbsp;Tenured: 62546K-&gt;60809K(174784K)则表示 old generation变化及总量</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>2.2 Parallel GC</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; Paralle GC 通过加入参数&nbsp;-XX:+UseParallelGC 来指定(很多服务器默认不需?诱獠问湍鲜褂酶肎C collector -- 通过判断配置来决定)，通过再加入&nbsp;-XX:+UseParallelOldGC 使得 Full GC也启用并行，但在(<span style="color: rgb(51, 153, 102);"><em>http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html</em></span>)有如下介绍：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">-XX:-UseParallelGC：Use parallel garbage collection for scavenges. (Introduced in 1.4.1)<br/>-XX:-UseParallelOldGC：Use parallel garbage collection for the full collections. Enabling this option automatically sets -XX:+UseParallelGC. (Introduced in 5.0 update 6.)</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">如想详细查询是否真正自动启用(还是不加入-XX:+UseParallelOldGC有什么细微区别) 则可查看 Open JDK 参考实现来确定，本文不做详细分析，所以加上-XX:+UseParallelGC -XX:+UseParallelOldGC 会是个保险的选择。下面附上一段Open JDK 7的路径为：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">hotspot/src/share/vm/runtime/arguments.cpp 部分源码，估计会有些帮助:</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><em><span style="font-size: 12px;">void Arguments::set_parallel_gc_flags() {</span></em><br/><em><span style="font-size: 12px;">　　assert(UseParallelGC || UseParallelOldGC, &quot;Error&quot;);</span></em><br/><em><span style="font-size: 12px;">　　// If parallel old was requested, automatically enable parallel scavenge.</span></em><br/><em><span style="font-size: 12px;">　　if (UseParallelOldGC &amp;&amp; !UseParallelGC &amp;&amp; FLAG_IS_DEFAULT(UseParallelGC)) {</span></em><br/><em><span style="font-size: 12px;">　　　　FLAG_SET_DEFAULT(UseParallelGC, true);</span></em><br/><em><span style="font-size: 12px;">　　}</span></em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><em><span style="font-size: 12px;">　　// If no heap maximum was requested explicitly, use some reasonable fraction</span></em><br/><em><span style="font-size: 12px;">　　// of the physical memory, up to a maximum of 1GB.</span></em><br/><em><span style="font-size: 12px;">　　if (<strong>UseParallelGC</strong>) {</span></em><br/><em><span style="font-size: 12px;">　　　　FLAG_SET_ERGO(uintx, ParallelGCThreads,</span></em><br/><em><span style="font-size: 12px;">　　　　Abstract_VM_Version::parallel_worker_threads());</span></em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><em><span style="font-size: 12px;">　　　　// If InitialSurvivorRatio or MinSurvivorRatio were not specified, but the</span></em><br/><em><span style="font-size: 12px;">　　　　// SurvivorRatio has been set, reset their default values to SurvivorRatio +</span></em><br/><em><span style="font-size: 12px;">　　　　// 2. By doing this we make SurvivorRatio also work for Parallel Scavenger.</span></em><br/><em><span style="font-size: 12px;">　　　　// See CR 6362902 for details.</span></em><br/><em><span style="font-size: 12px;">　　　　if (!FLAG_IS_DEFAULT(SurvivorRatio)) {</span></em><br/><em><span style="font-size: 12px;">　　　　　　if (FLAG_IS_DEFAULT(InitialSurvivorRatio)) {</span></em><br/><em><span style="font-size: 12px;">　　　　　　　　FLAG_SET_DEFAULT(InitialSurvivorRatio, SurvivorRatio + 2);</span></em><br/><em><span style="font-size: 12px;">　　　　　　}</span></em><br/><em><span style="font-size: 12px;">　　　　　　if (FLAG_IS_DEFAULT(MinSurvivorRatio)) {</span></em><br/><em><span style="font-size: 12px;">　　　　　　　　FLAG_SET_DEFAULT(MinSurvivorRatio, SurvivorRatio + 2);</span></em><br/><em><span style="font-size: 12px;">　　　　　　}</span></em><br/><em><span style="font-size: 12px;">　　　　}</span></em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><em><span style="font-size: 12px;">　　　　if (<strong>UseParallelOldGC</strong>) {</span></em><br/><em><span style="font-size: 12px;">　　　　　　// Par compact uses lower default values since they are treated as</span></em><br/><em><span style="font-size: 12px;">　　　　　　// minimums. These are different defaults because of the different</span></em><br/><em><span style="font-size: 12px;">　　　　　　// interpretation and are not ergonomically set.</span></em><br/><em><span style="font-size: 12px;">　　　　　　if (FLAG_IS_DEFAULT(MarkSweepDeadRatio)) {</span></em><br/><em><span style="font-size: 12px;">　　　　　　　　FLAG_SET_DEFAULT(MarkSweepDeadRatio, 1);</span></em><br/><em><span style="font-size: 12px;">　　　　　　}</span></em><br/><em><span style="font-size: 12px;">　　　　　　if (FLAG_IS_DEFAULT(PermMarkSweepDeadRatio)) {</span></em><br/><em><span style="font-size: 12px;">　　　　　　　　FLAG_SET_DEFAULT(PermMarkSweepDeadRatio, 5);</span></em><br/><em><span style="font-size: 12px;">　　　　　　}</span></em><br/><em><span style="font-size: 12px;">　　　　}</span></em><br/><em><span style="font-size: 12px;">　　}</span></em><br/><em><span style="font-size: 12px;">　　if (UseNUMA) {</span></em><br/><em><span style="font-size: 12px;">　　　　if (FLAG_IS_DEFAULT(MinHeapDeltaBytes)) {</span></em><br/><em><span style="font-size: 12px;">　　　　　　FLAG_SET_DEFAULT(MinHeapDeltaBytes, 64*M);</span></em><br/><em><span style="font-size: 12px;">　　　　}</span></em><br/><em><span style="font-size: 12px;">　　}</span></em><br/><span style="font-size: 12px;">}</span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">--------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 128, 0);">[GC [PSYoungGen: 88524K-&gt;10728K(274944K)] 133505K-&gt;61187K(450048K), 0.0374438 secs] [Times: user=0.08 sys=0.00, real=0.04 secs]</span>&nbsp;<br/><span style="color: rgb(255, 102, 0);">[Full GC [PSYoungGen: 10728K-&gt;0K(274944K)] [ParOldGen: 50459K-&gt;50210K(175104K)] 61187K-&gt;50210K(450048K) [PSPermGen: 38656K-&gt;38643K(77312K)], 0.3787131 secs] [Times: user=0.98 sys=0.02, real=0.38 secs]</span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">--------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">1.&nbsp;PSYoungGen 代表并行回收 young generation</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">2. ParOldGen 代表并行回收 old generation.</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">3.&nbsp;PSPermGen 代表并行回收 Permanent&nbsp;generation. 其他的参数与前面解释的类似。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>2.3 CMS GC</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; CMS GC相对来说比较复杂，通过使用&nbsp;-XX:+UseConcMarkSweepGC 参数在指定，但是一般情况需要更多的其他参数来保证它能比较好地达到我们的低延时目的，下面就部分常用参数做介绍：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">-XX:+CMSIncrementalMode &nbsp; &nbsp; 采用增量式的标记方式，减少标记时应用停顿时间<br/>-XX:+CMSParallelRemarkEnabled &nbsp; &nbsp; 启用并行标记<br/>-XX:CMSInitiatingOccupancyFraction=70 &nbsp; &nbsp; Old generation消耗比例达到多少时进行回收，通常配置60-80之间<br/>-XX:CMSFullGCsBeforeCompaction=1 &nbsp; &nbsp; 多少次Full GC 后压缩old generation一次<br/>-XX:+UseCMSInitiatingOccupancyOnly <br/>-XX:+ScavengeBeforeFullGC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Old generation GC前对young generation GC一次，默认开启。<br/>-XX:+CMSScavengeBeforeRemark &nbsp; &nbsp; CMS remark之前进行一次young generation GC</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">关于CMSFullGCsBeforeCompaction 的参数影响在Open JDK中如下判断：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em>*should_compact =</em></span><br/><span style="font-size: 12px;"><em>UseCMSCompactAtFullCollection &amp;&amp;</em></span><br/><span style="font-size: 12px;"><em>((_full_gcs_since_conc_gc &gt;= CMSFullGCsBeforeCompaction) ||</em></span><br/><span style="font-size: 12px;"><em>GCCause::is_user_requested_gc(gch-&gt;gc_cause()) ||</em></span><br/><span style="font-size: 12px;"><em>gch-&gt;incremental_collection_will_fail(true /* consult_young */));</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">关于UseCMSInitiatingOccupancyOnly&nbsp; 参数的详细解释如下:</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">-XX:+UseCMSInitiatingOccupancyOnly instructs the HotSpot VM to always use&nbsp;the -XX:CMSInitiatingOccupancyFraction as the occupancy of the old generation&nbsp;space to initiate a CMS cycle.</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">If -XX:+UseCMSInitiatingOccupancyOnly&nbsp;<em id="__mceDel" style="line-height: 1.5;"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">is not used, the HotSpot VM uses the -XX:CMSInitiatingOccupancyFraction&nbsp;</em></em></em></em><em id="__mceDel" style="line-height: 1.5;"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">as the occupancy percentage to start only the first CMS cycle. It then attempts to&nbsp;</em></em></em></em></em><em id="__mceDel" style="line-height: 1.5;"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">adaptively adjust when to start the CMS cycle for subsequent CMS cycles, that is,&nbsp;</em></em></em></em></em></em><em id="__mceDel" style="line-height: 1.5;"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">it no longer uses the specified -XX:CMSInitiatingOccupancyFraction after the&nbsp;</em></em></em></em></em></em></em><em id="__mceDel" style="line-height: 1.5;"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">first CMS cycle</em></em></em></em></em></em></em></em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">下面为一个可参考的CMS GC配置，根据应用的不同用途做相应修改(下面打印了GC LOG)：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">------------------------------------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">JAVA_OPTS=&quot;<br/>-DappName=XXX<br/>-server&nbsp;<br/>-Xms10g -Xmx10g<br/>-XX:NewSize=4g -XX:MaxNewSize=4g<br/>-XX:PermSize=256m -XX:MaxPermSize=256m</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>-XX:+UseConcMarkSweepGC</strong><br/><strong>-XX:+CMSIncrementalMode -XX:+CMSParallelRemarkEnabled</strong><br/><strong>-XX:CMSInitiatingOccupancyFraction=70 -XX:CMSFullGCsBeforeCompaction=1</strong><br/><strong>-XX:+UseCMSInitiatingOccupancyOnly</strong><br/><strong>-XX:+ScavengeBeforeFullGC -XX:+CMSScavengeBeforeRemark</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">-XX:+PrintGCDateStamps -verbose:gc -XX:+PrintGCDetails -Xloggc:/home/XX/gc/XX_gc.log<br/>-XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=10M</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/home/XX/dump_OOME.hprof</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">-XX:+DisableExplicitGC</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&quot;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">-----------------------------------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">下面使用一段LOG 作为 CMS GC行为：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">--------------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 128, 0);"><em>[GC [ParNew: 5033216K-&gt;629120K(5662336K), 19.9680140 secs] 5033216K-&gt;2091720K(11953792K), 19.9682480 secs] [Times: user=119.82 sys=14.07, real=19.97 secs]</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 102, 0);"><em>[GC [1 CMS-initial-mark: 1462600K(6291456K)] 4404491K(11953792K), 3.6824630 secs] [Times: user=3.67 sys=0.01, real=3.69 secs]&nbsp;</em></span><br/><span style="color: rgb(255, 102, 0);"><em>[CMS-concurrent-mark-start]</em></span><br/><em><span style="color: rgb(0, 128, 0);">[[ParNew: 5662336K-&gt;629120K(5662336K), 6.8885140 secs] 7124936K-&gt;4366353K(11953792K), 6.8886670 secs] [Times: user=136.94 sys=0.92, real=6.89 secs]</span>&nbsp;</em><br/><em><span style="color: rgb(255, 102, 0);">[CMS-concurrent-mark: 2.053/75.039 secs] [Times: user=192.12 sys=3.19, real=75.04 secs]</span>&nbsp;</em><br/><span style="color: rgb(0, 128, 0);"><em>[CMS-concurrent-preclean-start]</em></span><br/><em><span style="color: rgb(255, 102, 0);">[CMS-concurrent-preclean: 6.159/6.274 secs] [Times: user=7.53 sys=0.30, real=6.28 secs]</span>&nbsp;</em><br/><span style="color: rgb(0, 128, 0);"><em>[CMS-concurrent-abortable-preclean-start]</em></span><br/><em><span style="color: rgb(255, 102, 0);">[CMS-concurrent-abortable-preclean: 10.680/10.681 secs] [Times: user=12.77 sys=0.43, real=10.68 secs]</span>&nbsp;</em><br/><em><span style="color: rgb(0, 128, 0);">[GC[YG occupancy: 3043648 K (5662336 K)] [GC [ParNew: 3043648K-&gt;629120K(5662336K), 1.5345480 secs] 6780882K-&gt;4985422K(11953792K), 1.5346490 secs] [Times: user=30.72 sys=0.27, real=1.53 secs]</span>&nbsp;</em><br/><em><span style="color: rgb(255, 102, 0);">[Rescan (parallel) , 0.1900960 secs] [weak refs processing, 0.0000460 secs] [scrub string table, 0.0008680 secs] [1 CMS-remark: 4356302K(6291456K)] 4985422K(11953792K), 1.7259240 secs] [Times: user=34.88 sys=0.27, real=1.72 secs]</span>&nbsp;</em><br/><span style="color: rgb(0, 128, 0);"><em>[CMS-concurrent-sweep-start]</em></span><br/><span style="color: rgb(255, 102, 0);"><em>[CMS-concurrent-sweep: 3.379/3.380 secs] [Times: user=4.05 sys=0.13, real=3.38 secs]</em></span><br/><span style="color: rgb(0, 128, 0);"><em>[CMS-concurrent-reset-start]</em></span><br/><span style="color: rgb(255, 102, 0);"><em>[CMS-concurrent-reset: 0.030/0.030 secs] [Times: user=0.02 sys=0.01, real=0.03 secs]</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">---------------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">默认情况下Full GC之前会进行一次 Mirror GC，日志中的第一行则是，含义和前面的描述一样，不再赘述。&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">其他的则是CMS GC 的各个周期(<a title="Java GC - 垃圾回收机制" href="http://www.cnblogs.com/mikevictor07/p/5023776.html" target="_blank" style="color: rgb(29, 88, 209); text-decoration: none;">在前一篇文章中有描述</a>)，其中只在 CMS-remark阶段应用暂停时间最长，但相对Parallel GC来说它相对会短些。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 18px;"><strong>3. GC监控工具</strong></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; GC 监控工具有JDK自带的工具和第三方分析工具，同时包含命令行与GUI工具</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><em>附：&nbsp;<strong>jstack</strong>&nbsp;命令可以查询当前应用线程状态，可用于判断是否存在死锁、线程等待原因等问题。</em></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>3.1 jmap</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; jmap 有几项参数，直接执行jmap命令可打印这些选项，下面列出 -heap 参数打印情况(关键点粗体字标出)：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">--------------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em><strong>Server compiler</strong>&nbsp;detected.</em></span><br/><span style="font-size: 12px;"><em>JVM version is 24.79-b02</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em><strong>using parallel threads in the new generation</strong>.</em></span><br/><span style="font-size: 12px;"><em>using thread-local object allocation.</em></span><br/><strong><span style="font-size: 12px;"><em>Concurrent Mark-Sweep GC</em></span></strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em>Heap Configuration:</em></span><br/><span style="font-size: 12px;"><em><strong>MinHeapFreeRatio</strong>&nbsp;= 40</em></span><br/><span style="font-size: 12px;"><em><strong>MaxHeapFreeRatio</strong>&nbsp;= 70</em></span><br/><span style="font-size: 12px;"><em><strong>MaxHeapSize</strong>&nbsp;= 2147483648 (2048.0MB)</em></span><br/><span style="font-size: 12px;"><em><strong>NewSize</strong>&nbsp;= 1310720 (1.25MB)</em></span><br/><span style="font-size: 12px;"><em><strong>MaxNewSize</strong>&nbsp;= 348913664 (332.75MB)</em></span><br/><span style="font-size: 12px;"><em><strong>OldSize</strong>&nbsp;= 5439488 (5.1875MB)</em></span><br/><span style="font-size: 12px;"><em><strong>NewRatio</strong>&nbsp;= 2</em></span><br/><span style="font-size: 12px;"><em><strong>SurvivorRatio</strong>&nbsp;= 8</em></span><br/><span style="font-size: 12px;"><em><strong>PermSize</strong>&nbsp;= 67108864 (64.0MB)</em></span><br/><span style="font-size: 12px;"><em><strong>MaxPermSize</strong>&nbsp;= 268435456 (256.0MB)</em></span><br/><span style="font-size: 12px;"><em>G1HeapRegionSize = 0 (0.0MB)</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em>Heap Usage:</em></span><br/><span style="font-size: 12px;"><em>New Generation (Eden + 1 Survivor Space):</em></span><br/><span style="font-size: 12px;"><em>capacity = 80543744 (76.8125MB)</em></span><br/><span style="font-size: 12px;"><em>used = 13761040 (13.123550415039062MB)</em></span><br/><span style="font-size: 12px;"><em>free = 66782704 (63.68894958496094MB)</em></span><br/><span style="font-size: 12px;"><em>17.08517547930228% used</em></span><br/><span style="font-size: 12px;"><em>Eden Space:</em></span><br/><span style="font-size: 12px;"><em>capacity = 71630848 (68.3125MB)</em></span><br/><span style="font-size: 12px;"><em>used = 4848144 (4.6235504150390625MB)</em></span><br/><span style="font-size: 12px;"><em>free = 66782704 (63.68894958496094MB)</em></span><br/><span style="font-size: 12px;"><em>6.768234825308783% used</em></span><br/><span style="font-size: 12px;"><em>From Space:</em></span><br/><span style="font-size: 12px;"><em>capacity = 8912896 (8.5MB)</em></span><br/><span style="font-size: 12px;"><em>used = 8912896 (8.5MB)</em></span><br/><span style="font-size: 12px;"><em>free = 0 (0.0MB)</em></span><br/><span style="font-size: 12px;"><em>100.0% used</em></span><br/><span style="font-size: 12px;"><em>To Space:</em></span><br/><span style="font-size: 12px;"><em>capacity = 8912896 (8.5MB)</em></span><br/><span style="font-size: 12px;"><em>used = 0 (0.0MB)</em></span><br/><span style="font-size: 12px;"><em>free = 8912896 (8.5MB)</em></span><br/><span style="font-size: 12px;"><em>0.0% used</em></span><br/><span style="font-size: 12px;"><em>concurrent mark-sweep generation:</em></span><br/><span style="font-size: 12px;"><em>capacity = 178978816 (170.6875MB)</em></span><br/><span style="font-size: 12px;"><em>used = 54910688 (52.366912841796875MB)</em></span><br/><span style="font-size: 12px;"><em>free = 124068128 (118.32058715820312MB)</em></span><br/><span style="font-size: 12px;"><em>30.679992876922373% used</em></span><br/><span style="font-size: 12px;"><em>Perm Generation:</em></span><br/><span style="font-size: 12px;"><em>capacity = 67108864 (64.0MB)</em></span><br/><span style="font-size: 12px;"><em>used = 37996544 (36.236328125MB)</em></span><br/><span style="font-size: 12px;"><em>free = 29112320 (27.763671875MB)</em></span><br/><span style="font-size: 12px;"><em>56.6192626953125% used</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em><strong>17968 interned Strings</strong>&nbsp;occupying 2174744 bytes.</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">--------------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>下面dump一份heap分配情况：</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">jmap -dump:format=b,file=d:/test.hprof 7880</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">其中 7880为 PID，导出的文件可使用Memory Analyzer, jvisualvm, jprofile等工具打开</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>3.2 jhat</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; 如果你导出的 hprof 文件很大不方便下载本地分析，可以使用 jhat 启动HTTP Server的后可以使用浏览器访问,</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">例如：执行&nbsp;jhat&nbsp;d:/test.hprof 后开启 7000 端口提供HTTP服务，使用浏览器即可访问:</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">---------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em>Snapshot read, resolving...</em></span><br/><span style="font-size: 12px;"><em>Resolving 2049558 objects...</em></span><br/><span style="font-size: 12px;"><em>Chasing references, expect 409 dots</em></span><br/><span style="font-size: 12px;"><em>...................................</em></span><br/><span style="font-size: 12px;"><em>Eliminating duplicate references...</em></span><br/><span style="font-size: 12px;"><em>...................................</em></span><br/><span style="font-size: 12px;"><em>Snapshot resolved.</em></span><br/><span style="font-size: 12px;"><em>Started HTTP server on port 7000</em></span><br/><span style="font-size: 12px;"><em>Server is ready.</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">---------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">注：如果导出的文件很大，则需要开启更多的内存空间，使用 &nbsp;-J-Xmx5g 命令则开启最大5G。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>3.3 jstat (jstatd) &amp; jvisualvm</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; jstat用于实时监测 GC情况，如PID为7880的应用监测，每 1000毫秒打印一次：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">---------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="font-size: 12px;"><em>jstat -gc 7880 1000</em></span><br/><strong><span style="font-size: 12px;"><em>S0C S1C S0U S1U EC EU OC OU PC PU YGC YGCT FGC FGCT GCT</em></span></strong><br/><span style="font-size: 12px;"><em>8704.0 8704.0 8704.0 0.0 69952.0 14761.0 277100.0 181950.8 65536.0 37705.5 60 2.946 35 1.285 4.231</em></span><br/><span style="font-size: 12px;"><em>8704.0 8704.0 8704.0 0.0 69952.0 14763.0 277100.0 181950.8 65536.0 37705.5 60 2.946 35 1.285 4.231</em></span></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">---------------------------</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">如果开启 jstatd 则可远程使用 jvisualvm 的图形化监控.</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>1.</strong>&nbsp;首先需要配置一个policy文件，内容如下( 假设名称为 tools.policy，根据安装路径不一进行相应修改 )：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">grant codebase &quot;file:/usr/java/jdk1.7.0_79/lib/tools.jar&quot; {<br/>permission java.security.AllPermission;<br/>};</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>2.</strong>&nbsp;然后启动jstatd服务，后面的IP地址为该服务绑定的地址：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">jstatd -J-Djava.security.policy=/home/XXX/tools.policy -J-Djava.rmi.server.hostname=192.168.X.X</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>3.</strong>&nbsp;在jvisualvm中添加 Remote，输入IP新建主机后右键添加 jstatd connection，稍等片刻即可连接，如下图：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><img src="http://images2015.cnblogs.com/blog/422439/201512/422439-20151207133015183-1669407858.png" alt="" width="318" height="196" style="border: 0px;"/></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">注：需要在 TOOLS-&gt;PLUGINs 中安装一些插件，如visual GC等才能查看一些更好的信息，如下图：</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><img src="http://images2015.cnblogs.com/blog/422439/201512/422439-20151207133457043-2082947555.png" alt="" style="border: 0px;"/></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>4. jconsole &amp; jps</strong></p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; jconsole大部分功能在jvisualvm中存在，所以使用的概率相对较小。jps 则是打印目前主机中正在启动的JAVA应用的PID。</p><p style="margin: 10px auto; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 25.2px; white-space: normal; background-color: rgb(255,
                        </code>
                        </pre>
                        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
                        <!-- UY BEGIN -->
                        <div id="uyan_frame"></div>
                        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2113268"></script>
                        <!-- UY END -->
                    </div>
                </div>
                <div id="footerInnerSeparator"></div>
            </div>
        </div>
        <div id="footerOuterSeparator"></div>
    </div>
    <br /><br /><br />
    <script src="../../js/jquery-1.9.1.js"></script>
    <script>
        window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": $("#divMain pre code").text(), "bdMini": "2", "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {}, "image": { "viewList": ["qzone", "tsina", "tqq", "renren", "weixin"], "viewText": "分享到：", "viewSize": "16" }, "selectShare": { "bdContainerClass": null, "bdSelectMiniList": ["qzone", "tsina", "tqq", "renren", "weixin"] } }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];
    </script>
</body>
</html>