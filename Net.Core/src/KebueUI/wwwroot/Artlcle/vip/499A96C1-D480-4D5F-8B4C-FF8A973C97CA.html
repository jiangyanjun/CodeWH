<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="Language" content="zh-CN">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../images/kebue.ico">
    <link rel="icon" href="../../images/kebue.ico">
    <meta name="description" content=RSA加密解密及RSA签名和验证>
    <meta name="keywords" content= /// summary /// RSA加密解密及RSA签名和验证 /// /summary public class RSACryption {     public RSACryption()  {      }    #region RSA 加密解密  #region RSA 的密钥产生   /// summary  /// RSA 的密钥产生 产生?皆?和公钥  /// /summary >
    <title>RSA加密解密及RSA签名和验证</title>

    <link href="../../template/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../template/styles/custom.css" rel="stylesheet" />
</head>
<body id="pageBody">
    <div id="divBoxed" class="container">
        <div class="transparent-bg" style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index: -1;zoom: 1;"></div>
        <div class="divPanel notop nobottom">
            <div class="row-fluid">
                <div class="span12">
                    <div id="divLogo">
                        <a href="../../../Home/Index" id="divSiteTitle">科布尔 kebue</a><br />
                        <a href="../../../Home/Index" id="divTagLine">开发者用代码改变世界从科布尔开始</a>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="divMenuRight" class="pull-right">
                        <div class="navbar">
                            <button type="button" class="btn btn-navbar-highlight btn-large btn-primary" data-toggle="collapse" data-target=".nav-collapse">
                                NAVIGATION <span class="icon-chevron-down icon-white"></span>
                            </button>
                            <div class="nav-collapse collapse">
                                <ul class="nav nav-pills ddmenu">
                                    <li class="dropdown glyphicon glyphicon-arrow-left"><a href='javascript:window.history.back()'>后退</a></li>
                                    <li class="dropdown active"><a href="http://www.kebue.com/">Home</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="contentInnerSeparator"></div>
                </div>
            </div>
        </div>
        <div class="contentArea">
            <div class="divPanel notop page-content">
                <div class="breadcrumbs">
                    <a href="../../../Home/Index">Home</a> &nbsp;/&nbsp; <span><a href='../../../../../Artlcle/ArticleType/B8C0509A-82D4-4BD7-A1BB-5BAF70ED1C60.html' title='.NET'>.NET</a></span>
                </div>
                <div class="row-fluid">
                    <div class="span12" id="divMain">
                        <h1>RSA加密解密及RSA签名和验证</h1>
                        <pre>
                        <code>
                            <p><span class="Apple-tab-span" style="white-space: pre;"> </span>/// &lt;summary&gt;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre"> </span>/// RSA加密解密及RSA签名和验证</p><p><span class="Apple-tab-span" style="white-space:pre"> </span>/// &lt;/summary&gt;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre"> </span>public class RSACryption&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre"> </span>{ <span class="Apple-tab-span" style="white-space:pre">  </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public RSACryption()&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{ <span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span></p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region RSA 加密解密&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region RSA 的密钥产生&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre"> </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>/// &lt;summary&gt;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>/// RSA 的密钥产生 产生?皆?和公钥&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>/// &lt;/summary&gt;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>/// &lt;param name=&quot;xmlKeys&quot;&gt;&lt;/param&gt;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>/// &lt;param name=&quot;xmlPublicKey&quot;&gt;&lt;/param&gt;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public void RSAKey(out string xmlKeys,out string xmlPublicKey)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{ <span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider rsa=new RSACryptoServiceProvider();&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>xmlKeys=rsa.ToXmlString(true);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>xmlPublicKey = rsa.ToXmlString(false); <span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region RSA的加密函数&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//##############################################################################&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA 方式加密&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//说明KEY必须是XML的行式,返回的是字符串&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//在有一点需要说明！！该加密方式有 长度 限制的！！&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//##############################################################################&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA的加密函数 &nbsp;string</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public string RSAEncrypt(string xmlPublicKey,string m_strEncryptString )&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] PlainTextBArray;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] CypherTextBArray;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>string Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>RSACryptoServiceProvider rsa=new RSACryptoServiceProvider();&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>rsa.FromXmlString(xmlPublicKey);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>PlainTextBArray = (new UnicodeEncoding()).GetBytes(m_strEncryptString);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>CypherTextBArray = rsa.Encrypt(PlainTextBArray, false);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>Result=Convert.ToBase64String(CypherTextBArray);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA的加密函数 byte[]</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public string RSAEncrypt(string xmlPublicKey,byte[] EncryptString )&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] CypherTextBArray;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>string Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>RSACryptoServiceProvider rsa=new RSACryptoServiceProvider();&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>rsa.FromXmlString(xmlPublicKey);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>CypherTextBArray = rsa.Encrypt(EncryptString, false);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>Result=Convert.ToBase64String(CypherTextBArray);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region RSA的解密函数&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA的解密函数 &nbsp;string</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public string RSADecrypt(string xmlPrivateKey, string m_strDecryptString )&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{<span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] PlainTextBArray;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] DypherTextBArray;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>string Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>System.Security.Cryptography.RSACryptoServiceProvider rsa=new RSACryptoServiceProvider();&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>rsa.FromXmlString(xmlPrivateKey);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>PlainTextBArray =Convert.FromBase64String(m_strDecryptString);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>DypherTextBArray=rsa.Decrypt(PlainTextBArray, false);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>Result=(new UnicodeEncoding()).GetString(DypherTextBArray);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA的解密函数 &nbsp;byte</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public string RSADecrypt(string xmlPrivateKey, byte[] DecryptString )&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{<span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] DypherTextBArray;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>string Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>System.Security.Cryptography.RSACryptoServiceProvider rsa=new RSACryptoServiceProvider();&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>rsa.FromXmlString(xmlPrivateKey);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>DypherTextBArray=rsa.Decrypt(DecryptString, false);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>Result=(new UnicodeEncoding()).GetString(DypherTextBArray);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return Result;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region RSA数字签名&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region 获取Hash描述表&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//获取Hash描述表&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool GetHash(string m_strSource, ref byte[] HashData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{ <span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>//从字符串中取得Hash描述&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] Buffer;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>System.Security.Cryptography.HashAlgorithm MD5 = System.Security.Cryptography.HashAlgorithm.Create(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>Buffer = System.Text.Encoding.GetEncoding(&quot;GB2312&quot;).GetBytes(m_strSource);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>HashData = MD5.ComputeHash(Buffer);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return true; <span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//获取Hash描述表&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool GetHash(string m_strSource, ref string strHashData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>//从字符串中取得Hash描述&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] Buffer;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] HashData;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>System.Security.Cryptography.HashAlgorithm MD5 = System.Security.Cryptography.HashAlgorithm.Create(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>Buffer = System.Text.Encoding.GetEncoding(&quot;GB2312&quot;).GetBytes(m_strSource);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>HashData = MD5.ComputeHash(Buffer);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>strHashData = Convert.ToBase64String(HashData);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//获取Hash描述表&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool GetHash(System.IO.FileStream objFile, ref byte[] HashData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>//从文件中取得Hash描述&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>System.Security.Cryptography.HashAlgorithm MD5 = System.Security.Cryptography.HashAlgorithm.Create(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>HashData = MD5.ComputeHash(objFile);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>objFile.Close();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//获取Hash描述表&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool GetHash(System.IO.FileStream objFile, ref string strHashData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>//从文件中取得Hash描述&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>byte[] HashData;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>System.Security.Cryptography.HashAlgorithm MD5 = System.Security.Cryptography.HashAlgorithm.Create(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>HashData = MD5.ComputeHash(objFile);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span>objFile.Close();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>strHashData = Convert.ToBase64String(HashData);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">   </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region RSA签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureFormatter(string p_strKeyPrivate, byte[] HashbyteSignature, ref byte[] EncryptedSignatureData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPrivate);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureFormatter RSAFormatter = new System.Security.Cryptography.RSAPKCS1SignatureFormatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//设置签名的算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSAFormatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//执行签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>EncryptedSignatureData = RSAFormatter.CreateSignature(HashbyteSignature);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureFormatter(string p_strKeyPrivate, byte[] HashbyteSignature, ref string m_strEncryptedSignatureData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] EncryptedSignatureData;&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPrivate);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureFormatter RSAFormatter = new System.Security.Cryptography.RSAPKCS1SignatureFormatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//设置签名的算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSAFormatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//执行签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>EncryptedSignatureData = RSAFormatter.CreateSignature(HashbyteSignature);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>m_strEncryptedSignatureData = Convert.ToBase64String(EncryptedSignatureData);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureFormatter(string p_strKeyPrivate, string m_strHashbyteSignature, ref byte[] EncryptedSignatureData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] HashbyteSignature;&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>HashbyteSignature = Convert.FromBase64String(m_strHashbyteSignature);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPrivate);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureFormatter RSAFormatter = new System.Security.Cryptography.RSAPKCS1SignatureFormatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//设置签名的算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSAFormatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//执行签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>EncryptedSignatureData = RSAFormatter.CreateSignature(HashbyteSignature);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>//RSA签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureFormatter(string p_strKeyPrivate, string m_strHashbyteSignature, ref string m_strEncryptedSignatureData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] HashbyteSignature;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] EncryptedSignatureData;&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>HashbyteSignature = Convert.FromBase64String(m_strHashbyteSignature);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPrivate);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureFormatter RSAFormatter = new System.Security.Cryptography.RSAPKCS1SignatureFormatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//设置签名的算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSAFormatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//执行签名&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>EncryptedSignatureData = RSAFormatter.CreateSignature(HashbyteSignature);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>m_strEncryptedSignatureData = Convert.ToBase64String(EncryptedSignatureData);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#region RSA 签名验证&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureDeformatter(string p_strKeyPublic, byte[] HashbyteDeformatter, byte[] DeformatterData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPublic);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureDeformatter RSADeformatter = new System.Security.Cryptography.RSAPKCS1SignatureDeformatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//指定解密的时候HASH算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSADeformatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>if(RSADeformatter.VerifySignature(HashbyteDeformatter,DeformatterData))&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>else&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return false;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureDeformatter(string p_strKeyPublic, string p_strHashbyteDeformatter, byte[] DeformatterData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] HashbyteDeformatter;&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>HashbyteDeformatter = Convert.FromBase64String(p_strHashbyteDeformatter);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPublic);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureDeformatter RSADeformatter = new System.Security.Cryptography.RSAPKCS1SignatureDeformatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//指定解密的时候HASH算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSADeformatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>if(RSADeformatter.VerifySignature(HashbyteDeformatter,DeformatterData))&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>else&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return false;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureDeformatter(string p_strKeyPublic, byte[] HashbyteDeformatter, string p_strDeformatterData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] DeformatterData;&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPublic);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureDeformatter RSADeformatter = new System.Security.Cryptography.RSAPKCS1SignatureDeformatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//指定解密的时候HASH算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSADeformatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>DeformatterData =Convert.FromBase64String(p_strDeformatterData);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>if(RSADeformatter.VerifySignature(HashbyteDeformatter,DeformatterData))&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>else&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return false;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>public bool SignatureDeformatter(string p_strKeyPublic, string p_strHashbyteDeformatter, string p_strDeformatterData)&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">  </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] DeformatterData;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>byte[] HashbyteDeformatter;&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>HashbyteDeformatter = Convert.FromBase64String(p_strHashbyteDeformatter);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSACryptoServiceProvider RSA = new System.Security.Cryptography.RSACryptoServiceProvider();&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSA.FromXmlString(p_strKeyPublic);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>System.Security.Cryptography.RSAPKCS1SignatureDeformatter RSADeformatter = new System.Security.Cryptography.RSAPKCS1SignatureDeformatter(RSA);&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>//指定解密的时候HASH算法为MD5&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>RSADeformatter.SetHashAlgorithm(&quot;MD5&quot;);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>DeformatterData =Convert.FromBase64String(p_strDeformatterData);&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">    </span>if(RSADeformatter.VerifySignature(HashbyteDeformatter,DeformatterData))&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return true;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>else&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>{&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">     </span>return false;&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">    </span>}&nbsp;</p><p><span class="Apple-tab-span" style="white-space:pre">   </span></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>}&nbsp;</p><p><br/></p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><br/></p><p><span class="Apple-tab-span" style="white-space:pre">  </span>#endregion&nbsp;</p><p><br/></p><p><span class="Apple-tab-span" style="white-space: pre;"> </span>}</p><p><br/></p>
                        </code>
                        </pre>
                        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
                        <!-- UY BEGIN -->
                        <div id="uyan_frame"></div>
                        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2113268"></script>
                        <!-- UY END -->
                    </div>
                </div>
                <div id="footerInnerSeparator"></div>
            </div>
        </div>
        <div id="footerOuterSeparator"></div>
    </div>
    <br /><br /><br />
    <script src="../../js/jquery-1.9.1.js"></script>
    <script>
        window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": $("#divMain pre code").text(), "bdMini": "2", "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {}, "image": { "viewList": ["qzone", "tsina", "tqq", "renren", "weixin"], "viewText": "分享到：", "viewSize": "16" }, "selectShare": { "bdContainerClass": null, "bdSelectMiniList": ["qzone", "tsina", "tqq", "renren", "weixin"] } }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];
    </script>
</body>
</html>