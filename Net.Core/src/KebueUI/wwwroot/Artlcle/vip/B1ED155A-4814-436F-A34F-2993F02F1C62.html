<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="Language" content="zh-CN">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../images/kebue.ico">
    <link rel="icon" href="../../images/kebue.ico">
    <meta name="description" content=System.Web.Caching.Cache类 缓存 各种缓存依赖>
    <meta name="keywords" content=　Cache类，是一个用于缓存常用信息的类。HttpRuntime.Cache以及HttpContext.Current.Cache都是该类的实例。一、属性属性说明Count获取存储在缓存中的项数。EffectivePercentagePhysicalMemoryLimit获取在 ASP.NET 开始从缓存中移除项之前应用程序可使用的物理内存百分比。EffectivePrivateBytesLim>
    <title>System.Web.Caching.Cache类 缓存 各种缓存依赖</title>

    <link href="../../template/scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../template/styles/custom.css" rel="stylesheet" />
</head>
<body id="pageBody">
    <div id="divBoxed" class="container">
        <div class="transparent-bg" style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;z-index: -1;zoom: 1;"></div>
        <div class="divPanel notop nobottom">
            <div class="row-fluid">
                <div class="span12">
                    <div id="divLogo">
                        <a href="../../../Home/Index" id="divSiteTitle">科布尔 kebue</a><br />
                        <a href="../../../Home/Index" id="divTagLine">开发者用代码改变世界从科布尔开始</a>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="divMenuRight" class="pull-right">
                        <div class="navbar">
                            <button type="button" class="btn btn-navbar-highlight btn-large btn-primary" data-toggle="collapse" data-target=".nav-collapse">
                                NAVIGATION <span class="icon-chevron-down icon-white"></span>
                            </button>
                            <div class="nav-collapse collapse">
                                <ul class="nav nav-pills ddmenu">
                                    <li class="dropdown glyphicon glyphicon-arrow-left"><a href='javascript:window.history.back()'>后退</a></li>
                                    <li class="dropdown active"><a href="http://www.kebue.com/">Home</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div id="contentInnerSeparator"></div>
                </div>
            </div>
        </div>
        <div class="contentArea">
            <div class="divPanel notop page-content">
                <div class="breadcrumbs">
                    <a href="../../../Home/Index">Home</a> &nbsp;/&nbsp; <span><a href='../../../../../Artlcle/ArticleType/B8C0509A-82D4-4BD7-A1BB-5BAF70ED1C60.html' title='.NET'>.NET</a></span>
                </div>
                <div class="row-fluid">
                    <div class="span12" id="divMain">
                        <h1>System.Web.Caching.Cache类 缓存 各种缓存依赖</h1>
                        <pre>
                        <code>
                            <p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　Cache类，是一个用于缓存常用信息的类。HttpRuntime.Cache以及HttpContext.Current.Cache都是该类的实例。</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">一、属性</span></h1><table width="755"><tbody><tr class="firstRow"><td style="border-color: silver; border-collapse: collapse; padding: 3px;">属性</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">说明</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Count</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">获取存储在缓存中的项数。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">EffectivePercentagePhysicalMemoryLimit</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">获取在 ASP.NET 开始从缓存中移除项之前应用程序可使用的物理内存百分比。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">EffectivePrivateBytesLimit</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">获取可用于缓存的字节数。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Item</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">获取或设置指定键处的缓存项。</td></tr></tbody></table><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">二、方法</span></h1><table width="978"><tbody><tr class="firstRow"><td style="border-color: silver; border-collapse: collapse; padding: 3px;">方法名称</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">说明</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Add</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">将指定项添加到 Cache 对象，该对象具有依赖项、到期和优先级策略以及一个委托（可用于在从 Cache 移除插入项时通知应用程序）。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Get</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">从 Cache 对象检索指定项。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">GetEnumerator</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">检索用于循环访问包含在缓存中的键设置及其值的字典枚举数。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Insert(String, Object)</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">向 Cache 对象插入项，该项带有一个缓存键引用其位置，并使用 CacheItemPriority 枚举提供的默认值。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Insert(String, Object, CacheDependency)</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">向 Cache 中插入具有文件依赖项或键依赖项的对象。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Insert(String, Object, CacheDependency, DateTime, TimeSpan)</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">向 Cache 中插入具有依赖项和到期策略的对象。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Insert(String, Object, CacheDependency, DateTime, TimeSpan, CacheItemUpdateCallback)</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">将对象与依赖项、到期策略以及可用于在从缓存中移除项之前通知应用程序的委托一起插入到 Cache 对象中。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Insert(String, Object, CacheDependency, DateTime, TimeSpan, CacheItemPriority, CacheItemRemovedCallback)</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">向 Cache 对象中插入对象，后者具有依赖项、到期和优先级策略以及一个委托（可用于在从 Cache 移除插入项时通知应用程序）。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Remove</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">从应用程序的 Cache 对象移除指定项。</td></tr></tbody></table><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">三、静态字段</span></h1><table width="754"><tbody><tr class="firstRow"><td style="border-color: silver; border-collapse: collapse; padding: 3px;">名称</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">说明</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">NoAbsoluteExpiration&nbsp;</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">用于 Insert 方法调用中的 absoluteExpiration 参数中以指示项从不到期。 此字段为只读。</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">NoSlidingExpiration</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">用作 Insert 或 Add 方法调用中的 slidingExpiration 参数，以禁用可调到期。 此字段为只读。</td></tr></tbody></table><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　先来看基本的示例：</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　index.aspx.cs页面代码:</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">namespace&nbsp;WebApplication1
{&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;_Default&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Person&nbsp;p&nbsp;=&nbsp;new&nbsp;Person();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Id&nbsp;=&nbsp;1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.Name&nbsp;=&nbsp;&quot;诸葛亮&quot;;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpRuntime.Cache;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;AA&quot;,p);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;BB&quot;,&quot;字符串&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(cache.Get(&quot;BB&quot;).ToString());&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//输出&nbsp;字符串
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Person&nbsp;p2&nbsp;=&nbsp;cache[&quot;AA&quot;]&nbsp;as&nbsp;Person;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(p2.Id&nbsp;+&nbsp;&quot;&nbsp;:&nbsp;&quot;&nbsp;+&nbsp;p2.Name);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//输出&nbsp;1&nbsp;:&nbsp;诸葛亮
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(cache.EffectivePrivateBytesLimit);&nbsp;&nbsp;&nbsp;//-1&nbsp;这是一个只读属性，那就没什么好说了，只能输出来看看了，但是-1是什么意思呢？无限吗
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(cache.EffectivePercentagePhysicalMemoryLimit);&nbsp;&nbsp;&nbsp;//98&nbsp;&nbsp;&nbsp;&nbsp;开始移除项之前可以使用到98%

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(cache.Count);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//输出&nbsp;3
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(cache[&quot;BB&quot;]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//输出&nbsp;字符串&nbsp;支持索引器式的读取
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Remove(&quot;BB&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//从cache中移除一项
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(&quot;~~~&quot;&nbsp;+&nbsp;cache[&quot;BB&quot;]&nbsp;+&nbsp;&quot;~~~&quot;);&nbsp;&nbsp;&nbsp;&nbsp;//移除了输出&nbsp;null，但程序不报错

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(var&nbsp;obj&nbsp;in&nbsp;cache)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(obj.GetType()&nbsp;+&nbsp;&quot;&lt;br/&gt;&quot;);&nbsp;&nbsp;&nbsp;&nbsp;//输出不知道什么鸟东西&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;Person
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;int&nbsp;Id
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;string&nbsp;Name
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">四、文件缓存依赖</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　当被依赖的文件更改时，缓存会立即被清空：</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　index.aspx.cs代码：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;_Default&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpContext.Current.Cache;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//文件缓存依赖
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;CC&quot;,&nbsp;&quot;依赖项测试&quot;,&nbsp;new&nbsp;CacheDependency(@&quot;D:\123.txt&quot;));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//这时候在about.aspx页面添加一行代码，当更改一下D:123.txt时，cache[&quot;cc&quot;]会立即被清空&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　about.aspx.cs代码：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;About&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//直接打开本页面，输出缓存依赖项测试&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//当更改D:\123.txt之后，在刷新，输出空，表明该Cache是依赖于D:\123.txt的
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(HttpContext.Current.Cache[&quot;CC&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">五、NoSlidingExpiration 绝对过期时间</span></h1><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; line-height: 19.5px; background-color: rgb(255, 255, 255);">　　NoSlidingExpiration　　绝对过期时间，当超过设定时间，立即移除。</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　下面来看下绝对过期时间的示例，index.aspx.cs:</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;_Default&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpContext.Current.Cache;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//30秒后就到期，立即移除，没商量
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;DD&quot;,&nbsp;&quot;绝对过期测试&quot;,&nbsp;null,&nbsp;DateTime.Now.AddSeconds(5),&nbsp;System.Web.Caching.Cache.NoSlidingExpiration);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　about.aspx.cs:</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;About&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//先打开index.aspx添加到缓存&nbsp;然后立即打开本页面，输出&nbsp;绝对过期测试&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//持续刷新5秒后，不会再输出　　绝对过期测试
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(HttpContext.Current.Cache[&quot;DD&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">六、NoAbsoluteExpiration&nbsp;滑动过期时间</span></h1><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; line-height: 19.5px; background-color: rgb(255, 255, 255);">　　NoAbsoluteExpiration　　当超过设定时间没再使用时，才移除缓存</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　滑动过期测试,index.aspx.cs:</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;_Default&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpContext.Current.Cache;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//弹性过期时间，当缓存没使用10秒就过期
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;DD&quot;,&nbsp;&quot;滑动过期测试&quot;,&nbsp;null,&nbsp;System.Web.Caching.Cache.NoAbsoluteExpiration,TimeSpan.FromSeconds(10));
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　about.aspx.cs:</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;About&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//直接打开本页面，输出弹性过期测试&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//如果一直不停地刷新，都会继续输出，但是当超过10秒后再刷新，不会再输出&nbsp;&nbsp;&nbsp;滑动缓存测试
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(HttpContext.Current.Cache[&quot;DD&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;　　<span style="color: rgb(255, 0, 0);"><strong class="le">注意</strong></span><span style="color: rgb(255, 0, 0);">&nbsp;&nbsp;&nbsp;当设置绝对到期时间时，请使用 DateTime 结构。当设置弹性过期时间时，请使用 TimeSpan 结构。另外，如果您创建的弹性过期时间小于零或大于一年，则将引发 ArgumentOutOfRangeException 类</span>。</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">七、缓存的优先级设置</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　CacheItemPriority枚举　　设置缓存的优先级</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;_Default&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpContext.Current.Cache;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//文件权重级别
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Add(&quot;MyData&quot;,&nbsp;&quot;缓存重要级别&quot;,&nbsp;null,&nbsp;Cache.NoAbsoluteExpiration,&nbsp;TimeSpan.FromSeconds(30),&nbsp;CacheItemPriority.High,&nbsp;null);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　该枚举一共有六级：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">　　　　&nbsp;//在服务器释放系统内存时，具有该优先级级别的缓存项最有可能被从缓存删除。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Low&nbsp;=&nbsp;1,//在服务器释放系统内存时，具有该优先级级别的缓存项比分配了&nbsp;System.Web.Caching.CacheItemPriority.Normal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//优先级的项更有可能被从缓存删除。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BelowNormal&nbsp;=&nbsp;2,//在服务器释放系统内存时，具有该优先级级别的缓存项很有可能被从缓存删除，其被删除的可能性仅次于具有&nbsp;System.Web.Caching.CacheItemPriority.Low
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Normal&nbsp;=&nbsp;3,//缓存项优先级的默认值为&nbsp;System.Web.Caching.CacheItemPriority.Normal。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default&nbsp;=&nbsp;3,//在服务器释放系统内存时，具有该优先级级别的缓存项被删除的可能性比分配了&nbsp;System.Web.Caching.CacheItemPriority.Normal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//优先级的项要小。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AboveNormal&nbsp;=&nbsp;4,//在服务器释放系统内存时，具有该优先级级别的缓存项最不可能被从缓存删除。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;High&nbsp;=&nbsp;5,//在服务器释放系统内存时，具有该优先级级别的缓存项将不会被自动从缓存删除。但是，具有该优先级级别的项会根据项的绝对到期时间或可调整到期时间与其他项一起被移除
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NotRemovable&nbsp;=&nbsp;6,</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><table><tbody><tr style="background-color: rgb(220, 220, 220);" class="firstRow"><td style="border-color: silver; border-collapse: collapse; padding: 3px;">优先级</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Low=1</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">BelowNormal=2</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Normal=3</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">Default=3</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">AboveNormal=4</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">High=5</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">NotRemoveable=6</td></tr></tbody></table><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">八、当缓存被移除时，通知程序</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　这时就要用到Add的最后一个参数，委托了：</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　index.aspx.cs代码如下：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;_Default&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpRuntime.Cache;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//文件权重级别
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Add(&quot;MyData&quot;,&nbsp;&quot;缓冲移除通知&quot;,&nbsp;null,&nbsp;DateTime.Now.AddSeconds(10)&nbsp;,Cache.NoSlidingExpiration,CacheItemPriority.Low,&nbsp;Show);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;Show(string&nbsp;key,&nbsp;object&nbsp;value,&nbsp;CacheItemRemovedReason&nbsp;reason)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpRuntime.Cache;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache.Insert(&quot;MyData&quot;,&nbsp;&quot;缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　about.aspx.cs代码如下：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;About&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(HttpRuntime.Cache[&quot;MyData&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　此处实现的效果时：第一次打开index.aspx(让程序加入数据到缓存)，然后打开about.aspx显示出“缓存移除通知”，10秒后再刷新，显示</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">“缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!缓存被清空啦!”　　经测试，以上程序的Cache最好还是用HttpRuntime的，否则没有请求时HttpContext会报，“未将对象引用设置到对象的实例”。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　这就是被清空时会自动调用委托程序进行处理，你可以再次将数据添加进入缓存，或者记录到日志等等一系列操作。</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">九、数据库依赖缓存</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>　　1、配置的方式(sqlserver2000)&nbsp;</strong>SqlDependency第一个构造函数。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　首先一个WebForm的Web.Config中的配置文件修改如下：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&lt;connectionStrings&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;add&nbsp;name=&quot;ApplicationServices&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionString=&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;providerName=&quot;System.Data.SqlClient&quot;&nbsp;/&gt;
&nbsp;&nbsp;&lt;/connectionStrings&gt;

&nbsp;&nbsp;&lt;system.web&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;compilation&nbsp;debug=&quot;true&quot;&nbsp;targetFramework=&quot;4.0&quot;&nbsp;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;caching&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;sqlCacheDependency&nbsp;enabled=&quot;true&quot;&nbsp;pollTime=&quot;1000&quot;&gt;　　//此行配置的意思是，开启数据库缓存，轮询时间为1秒，这是为了能够快速看到更改效果
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;databases&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;add&nbsp;connectionStringName=&quot;ApplicationServices&quot;&nbsp;name=&quot;con&quot;/&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/databases&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/sqlCacheDependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/caching&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/system.web&gt;</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　修改Global.asax.cs文件代码如下：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application_Start(&nbsp;connString&nbsp;=&nbsp;System.Web.Configuration.WebConfigurationManager.ConnectionStrings[</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　Index.aspx.cs文件代码如下：</p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCacheDependency&nbsp;dependency&nbsp;=&nbsp;new&nbsp;SqlCacheDependency(&quot;con&quot;,&nbsp;&quot;Record&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;新增或修改一条缓存记录
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpRuntime.Cache.Insert(&quot;MyData&quot;,&nbsp;&quot;数据库缓存测试&quot;,&nbsp;dependency);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　About.aspx.cs文件代码如下：</p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(HttpRuntime.Cache[&quot;MyData&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　次数实现的效果时，打开Index.aspx.cs文件将数据添加到缓存后，然后打开about.asox，页面输出&quot;数据库缓存测试&quot;，这时候更改一下数据库的Record表，再刷新about.aspx页面，上一次输出的内容没有了。</p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">System.Data.SqlClient.SqlDependency.Start(connString);
System.Data.SqlClient.SqlDependency.Stop(connString);</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　这两行代码不一定要放在Global.asax.cs里面，在代码执行之前和执行之后就OK了。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　<span style="color: rgb(255, 0, 0);">注意，在这个例子当中，数据库要开启Service Broker</span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; line-height: 19.5px; background-color: rgb(255, 255, 255);">　　检测是否已经启用Service&nbsp;Broker</pre><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">Select&nbsp;DATABASEpRoPERTYEX(&#39;数据库名称&#39;,&#39;IsBrokerEnabled&#39;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;1&nbsp;表示已经启用&nbsp;0&nbsp;表示没有启用</pre><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; line-height: 19.5px; background-color: rgb(255, 255, 255);">　　启用Servicce&nbsp;Broker</pre><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">ALTER&nbsp;DATABASE&nbsp;NX&nbsp;SET&nbsp;ENABLE_BROKER;</pre><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; line-height: 19.5px; background-color: rgb(255, 255, 255);">如果启动时，一直显示正在执行查询，那么用一下这条语句</pre><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">ALTER&nbsp;DATABASE&nbsp;NX&nbsp;SET&nbsp;NEW_BROKER&nbsp;WITH&nbsp;ROLLBACK&nbsp;IMMEDIATE;ALTER&nbsp;DATABASE&nbsp;NX&nbsp;SET&nbsp;ENABLE_BROKER;</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>　　2、编程的方式(sqlserver2008)，第二个构造函数</strong>SqlDependency(sqlcommand sqlcom)</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>　　</strong>index.aspx.cs文件代码如下：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCacheDependency&nbsp;dependency;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlConnection&nbsp;conn&nbsp;=&nbsp;new&nbsp;SqlConnection(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;(conn)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;sql&nbsp;=&nbsp;&quot;select&nbsp;name&nbsp;from&nbsp;dbo.record&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCommand&nbsp;cmd&nbsp;=&nbsp;new&nbsp;SqlCommand(sql,&nbsp;conn);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dependency&nbsp;=&nbsp;new&nbsp;SqlCacheDependency(cmd);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlDataAdapter&nbsp;adapter&nbsp;=&nbsp;new&nbsp;SqlDataAdapter(cmd);&nbsp;&nbsp;&nbsp;//这里要特别注意，你的cmd一定要执行过，或者说Execute过，真正从数据库里面取出过数据
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataSet&nbsp;ds&nbsp;=&nbsp;new&nbsp;DataSet();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter.Fill(ds);&nbsp;　　//这里才是cmd真正执行的地方，注意真正执行要在绑定dependency之后
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(&quot;开始!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache.Insert(&quot;MyData&quot;,&nbsp;&quot;数据库依赖测试&quot;,&nbsp;dependency);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(&quot;完成!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　about.aspx.cs代码文件如下：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;partial&nbsp;class&nbsp;About&nbsp;:&nbsp;System.Web.UI.Page
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;Page_Load(object&nbsp;sender,&nbsp;EventArgs&nbsp;e)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(HttpRuntime.Cache[&quot;MyData&quot;]&nbsp;!=&nbsp;null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(HttpRuntime.Cache[&quot;MyData&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Response.Write(&quot;缓存已不存在!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　实现的效果一样是，打开index.aspx文件，再打开about.aspx文件，页面输出&quot;缓存测试结果&quot;，当更改表record之后，再刷新about.aspx页面，缓存被清空。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　再来一个例子，上次又是页面啥的，这次用十几行代码说明，这个东东实现的要点：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;void&nbsp;Main(string[]&nbsp;args)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpRuntime.Cache;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlDependency.Start(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;创建缓存依赖&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlConnection&nbsp;conn&nbsp;=&nbsp;new&nbsp;SqlConnection(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCommand&nbsp;command&nbsp;=&nbsp;new&nbsp;SqlCommand(&quot;select&nbsp;Id,name&nbsp;from&nbsp;dbo.Record&quot;,&nbsp;conn);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCacheDependency&nbsp;dependency&nbsp;=&nbsp;new&nbsp;SqlCacheDependency(command);&nbsp;&nbsp;&nbsp;&nbsp;//注意，创建的command与SqlCacheDependency绑定要在command执行之前
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlDataAdapter&nbsp;adapter&nbsp;=&nbsp;new&nbsp;SqlDataAdapter(command);&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataSet&nbsp;ds&nbsp;=&nbsp;new&nbsp;DataSet();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter.Fill(ds);&nbsp;&nbsp;&nbsp;&nbsp;//这里要特别注意，Fill才是真正执行&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;DD&quot;,&nbsp;&quot;数据库依赖测试&quot;,&nbsp;dependency);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(cache[&quot;DD&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.Sleep(20000);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//暂停20秒给你更改一下数据库
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cache[&quot;DD&quot;]&nbsp;==&nbsp;null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(&quot;数据库已经修改过了!&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadKey();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlDependency.Stop(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　在途中，我会随便修改一下Record表，输出结果如下：</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　<img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224744-548.jpg" alt=""/></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　再来一次数据库缓存依赖，回调函数的例子：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;Program
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;void&nbsp;Main(string[]&nbsp;args)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpRuntime.Cache;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlDependency.Start(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;创建缓存依赖&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlConnection&nbsp;conn&nbsp;=&nbsp;new&nbsp;SqlConnection(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCommand&nbsp;command&nbsp;=&nbsp;new&nbsp;SqlCommand(&quot;select&nbsp;Id,name&nbsp;from&nbsp;dbo.Record&quot;,&nbsp;conn);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCacheDependency&nbsp;dependency&nbsp;=&nbsp;new&nbsp;SqlCacheDependency(command);&nbsp;&nbsp;&nbsp;&nbsp;//注意，创建的command与SqlCacheDependency绑定要在command执行之前
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlDataAdapter&nbsp;adapter&nbsp;=&nbsp;new&nbsp;SqlDataAdapter(command);&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataSet&nbsp;ds&nbsp;=&nbsp;new&nbsp;DataSet();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter.Fill(ds);&nbsp;&nbsp;&nbsp;&nbsp;//这里要特别注意，Fill才是真正执行

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CacheItemRemovedCallback&nbsp;callback&nbsp;=&nbsp;new&nbsp;CacheItemRemovedCallback(RemovedCallback);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;DD&quot;,&nbsp;&quot;数据库依赖测试&quot;,&nbsp;dependency,&nbsp;DateTime.Now.AddDays(1),&nbsp;TimeSpan.Zero,&nbsp;CacheItemPriority.Default,&nbsp;callback);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(cache[&quot;DD&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.Sleep(15000);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//暂停15秒给你更改一下数据库
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cache[&quot;DD&quot;]&nbsp;==&nbsp;null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(&quot;数据库已经修改过了!&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadKey();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlDependency.Stop(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;RemovedCallback(string&nbsp;key,&nbsp;object&nbsp;value,&nbsp;CacheItemRemovedReason&nbsp;reason)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(&quot;缓存被移除!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(reason.ToString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　输出结果如下：</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　<img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224744-996.jpg" alt=""/></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　这里要补充几点：当设置为绝对过期时，后面那个TimeSpan参数要设为TimeSpan.Zero。另外，重载中还有一个方法之前在缓存移除前执行回调函数的，而刚刚那个是缓存数据被移除之后执行的。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 0, 0);"><strong>　　CacheItemUpdateCallback　　缓存数据移除之前调用；</strong></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 0, 0);"><strong>&nbsp;　 &nbsp;CacheItemRemoceCallback　　缓存数据移除之后调用；</strong></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 0, 0);"><strong>　　</strong><span style="color: rgb(0, 0, 0);">再来写一个：</span></span></p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;class&nbsp;Program
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;void&nbsp;Main(string[]&nbsp;args)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&nbsp;cache&nbsp;=&nbsp;HttpRuntime.Cache;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlDependency.Start(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;创建缓存依赖&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlConnection&nbsp;conn&nbsp;=&nbsp;new&nbsp;SqlConnection(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCommand&nbsp;command&nbsp;=&nbsp;new&nbsp;SqlCommand(&quot;select&nbsp;Id,name&nbsp;from&nbsp;dbo.Record&quot;,&nbsp;conn);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlCacheDependency&nbsp;dependency&nbsp;=&nbsp;new&nbsp;SqlCacheDependency(command);&nbsp;&nbsp;&nbsp;&nbsp;//注意，创建的command与SqlCacheDependency绑定要在command执行之前
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SqlDataAdapter&nbsp;adapter&nbsp;=&nbsp;new&nbsp;SqlDataAdapter(command);&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataSet&nbsp;ds&nbsp;=&nbsp;new&nbsp;DataSet();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adapter.Fill(ds);&nbsp;&nbsp;&nbsp;&nbsp;//这里要特别注意，Fill才是真正执行

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CacheItemUpdateCallback&nbsp;callback&nbsp;=&nbsp;new&nbsp;CacheItemUpdateCallback(RemovedCallback);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.Insert(&quot;DD&quot;,&nbsp;&quot;数据库依赖测试&quot;,&nbsp;dependency,&nbsp;DateTime.Now.AddDays(1),&nbsp;TimeSpan.Zero,&nbsp;callback);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(cache[&quot;DD&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.Sleep(15000);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//暂停15秒给你更改一下数据库
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cache[&quot;DD&quot;]&nbsp;==&nbsp;null)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(&quot;数据库已经修改过了!&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ReadKey();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Data.SqlClient.SqlDependency.Stop(@&quot;Server=KISSDODOG-PC;Database=Nx;uid=sa;pwd=123;&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;RemovedCallback(string&nbsp;key,&nbsp;CacheItemUpdateReason&nbsp;reason,&nbsp;out&nbsp;object&nbsp;expensiveObject,&nbsp;out&nbsp;CacheDependency&nbsp;dependency,&nbsp;out&nbsp;DateTime&nbsp;absoluteExpiration,&nbsp;out&nbsp;TimeSpan&nbsp;slidingExpiration)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;key:要从缓存中移除的项的标识符。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;reason:要从缓存中移除项的原因。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;expensiveObject:此方法返回时，包含含有更新的缓存项对象。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;dependency:此方法返回时，包含定义项对象和文件、缓存键、文件或缓存键的数组或另一个&nbsp;System.Web.Caching.CacheDependency&nbsp;对象之间的依赖项的对象。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;absoluteExpiration:此方法返回时，包含对象的到期时间。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;slidingExpiration:此方法返回时，包含对象的上次访问时间和对象的到期时间之间的时间间隔。
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expensiveObject&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dependency&nbsp;=&nbsp;null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;absoluteExpiration&nbsp;=&nbsp;DateTime.Now;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slidingExpiration&nbsp;=&nbsp;TimeSpan.Zero;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(&quot;缓存马上被移除!&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//但是现在还有没有呢？输出试试
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(HttpRuntime.Cache[&quot;DD&quot;]);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(reason.ToString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　输出结果为：</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　<img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224744-545.jpg" alt=""/></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　看到，在Update这个委托执行时，缓存还是存在的。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　注意:那个SQL语句还是比较严格的，主要要符合以下要求</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;a).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;必须设置完全限定名称的数据表。即表名前面需要加所有者，如dbo.test。</span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;b).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;必须明确设置所访问数据库列名称，不能使用“*”。</span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp;c).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;必须保证不是聚合函数。如COUNT、MAX等。</span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><table><tbody><tr style="background-color: rgb(220, 220, 220);" class="firstRow"><td style="border-color: silver; border-collapse: collapse; padding: 3px;"><br/></td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">SQL SERVER 7.0/2000</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">SQL SERVER 2005</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;">实现机制</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">轮询</td><td style="border-color: silver; border-collapse: collapse; padding: 3px;">通知传递服务(Service Broker)</td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;"><p style="margin: 10px auto;">是否需要配置启用</p></td><td style="border-color: silver; border-collapse: collapse; padding: 3px;"><p style="margin: 10px auto;">需要</p></td><td style="border-color: silver; border-collapse: collapse; padding: 3px;"><p style="margin: 10px auto;">不需要，内置支持</p></td></tr><tr><td style="border-color: silver; border-collapse: collapse; padding: 3px;"><p style="margin: 10px auto;">数据更改检测</p></td><td style="border-color: silver; border-collapse: collapse; padding: 3px;"><p style="margin: 10px auto;">限于表级更改监测</p></td><td style="border-color: silver; border-collapse: collapse; padding: 3px;"><p style="margin: 10px auto;">表级、行级更改监测</p></td></tr></tbody></table><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　很明显，SQL SERVER 2005的缓存机制更加高效。另外，SqlCacheDependency类还特别结合SQL SERVER 2005 进行了优化:</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; &nbsp; a).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;使用SQL SERVER 2005 时，SqlCacheDependency类支持与System.Data.SqlClient.SqlDependency类进行集成。应用程序可创建SqlDependency对象，并通过OnChanged事件处理程序接受通知进行注册。这样，应用程序不仅可以使用Sql server 2005的查询通知机制来监测使用SQL查询结果无效的数据更改，并将缓存对象从缓存中移除，而且还可以轻松获取数据更改通知，以便刷新缓存。(从这里可以看出，当触发onRemoveCallback委托的时候，数据已经从缓存里面删除了，这样一来可以手动在委托里面添加缓存，或者干脆设置成null，让他下次调用的时候再缓存。)</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp; &nbsp; &nbsp; &nbsp; b).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不仅向应用程序添加缓存依赖项，还可以与@OutputCache指令一起使用，以生成依赖于SqlServer数据库表的输出缓存的页面或用户控件。对于用户控件，@OutputCache指令不支持使用SQL SERVER 2005&nbsp;的查询通知(即onRemoveCallback委托)。</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">十、组合依赖缓存</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　当依赖的内容为多个Dependency时，可以通过AggregateCacheDependency创建依赖的组合，以便在任何一个依赖项发生变化时，使缓存项失效。<br/>　　组合的缓存依赖内部为一个集合，可以保存多个缓存依赖对象，将这些缓存依赖对象作为一个整体应用在缓存项目上，当其中某一个缓存依赖失效的时候，就可以使缓存的数据被丢弃。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　组合依赖缓存示例：</p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">//创建缓存依赖System.Web.Caching.SqlCacheDependency&nbsp;product&nbsp;=&nbsp;new&nbsp;System.Web.Caching.SqlCacheDependency(&quot;northwindcache&quot;,&quot;products&quot;);
System.Web.Caching.SqlCacheDependency&nbsp;category&nbsp;=&nbsp;new&nbsp;System.Web.Caching.SqlCacheDependency(&quot;northwindcache&quot;,&quot;products&quot;)//多个缓存依赖组合成一个依赖对象使用System.Web.Caching.AggregateCacheDependency&nbsp;acd&nbsp;=&nbsp;new&nbsp;System.Web.Caching.AggregateCacheDependency();
acd.Add(product,category);</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">十一、System.Web.Caching.Cache Insert和Add方法的区别</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>&nbsp;　　Add方法</strong></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">object&nbsp;Add(string&nbsp;key,&nbsp;object&nbsp;value,&nbsp;CacheDependency&nbsp;dependencies,&nbsp;DateTime&nbsp;absoluteExpiration,&nbsp;TimeSpan&nbsp;slidingExpiration,&nbsp;CacheItemPriority&nbsp;priority,&nbsp;CacheItemRemovedCallback&nbsp;onRemoveCallback);</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;　　<strong>Insert方法</strong></p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">void&nbsp;Insert(string&nbsp;key,&nbsp;object&nbsp;value);&nbsp;//永不过期void&nbsp;Insert(string&nbsp;key,&nbsp;object&nbsp;value,&nbsp;CacheDependency&nbsp;dependencies);　　//依赖void&nbsp;Insert(string&nbsp;key,&nbsp;object&nbsp;value,&nbsp;CacheDependency&nbsp;dependencies,&nbsp;DateTime&nbsp;absoluteExpiration,&nbsp;TimeSpan&nbsp;slidingExpiration);//绝对时间过期：void&nbsp;Insert(string&nbsp;key,&nbsp;object&nbsp;value,&nbsp;CacheDependency&nbsp;dependencies,&nbsp;DateTime&nbsp;absoluteExpiration,&nbsp;TimeSpan&nbsp;slidingExpiration,&nbsp;CacheItemUpdateCallback&nbsp;onUpdateCallback);　　//依赖+回调void&nbsp;Insert(string&nbsp;key,&nbsp;object&nbsp;value,&nbsp;CacheDependency&nbsp;dependencies,&nbsp;DateTime&nbsp;absoluteExpiration,&nbsp;TimeSpan&nbsp;slidingExpiration,&nbsp;CacheItemPriority&nbsp;priority,&nbsp;CacheItemRemovedCallback&nbsp;onRemoveCallback);　　//依赖+优先级+回调</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>&nbsp;　　比较、区别</strong></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　a). Insert方法支持5种重载，使用灵活，而Add方法必须提供7个参数；</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　b). Add方法可以返回缓存项的数据对象，Insert 返回Void；</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　c).&nbsp;<span style="color: rgb(255, 0, 0);"><strong>添加重复缓存情况下(Key已存在)，Insert会替换该项，而Add方法则不执行任何操作，并返回原来保存的object对象(Update 2014-03-18)。</strong></span></p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);"><strong>　　过期策略</strong>&nbsp;</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　a). 永不过期<br/>　　　　　　Insert(string key, object value);</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　b). 绝对时间过期</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　　　DateTime.Now.AddSeconds(10)表示缓存在10秒后过期，TimeSpan.Zero表示不使用平滑过期策略。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　　　例：Cache.Insert(&quot;Data&quot;, ds,null, DateTime.Now.AddSeconds(10), TimeSpan.Zero);</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　c). 变化时间过期（平滑过期）</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　　　DateTime.MaxValue表示不使用绝对时间过期策略，TimeSpan.FromSeconds(10)表示缓存连续10秒没有访问就过期。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　　　　　例：Cache.Insert(&quot;Data&quot;, ds, null, DateTime.MaxValue, TimeSpan.FromSeconds(10));</p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">十二、清空缓存</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　清空缓存主要通过Remove()方法，但是只能通过传入一个Key，清空一个。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　GetEnumerator()方法用于获取所有缓存项。MoveNext()用于将位置移动到下一个缓存项。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　如果想清空所有缓存，由于Cache类没有提供RemoveAll()方法，所以可以通过以下方式实现：</p><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IDictionaryEnumerator&nbsp;DicCache&nbsp;=&nbsp;HttpRuntime.Cache.GetEnumerator();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;count&nbsp;=&nbsp;HttpRuntime.Cache.Count;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;count;&nbsp;i++)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DicCache.MoveNext();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HttpRuntime.Cache.Remove(DicCache.Entry.Key.ToString());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><p><span class="cnblogs_code_copy" style="padding-right: 5px; line-height: 1.5 !important;"><a title="复制代码" style="color: rgb(68, 68, 68); border: none !important;"><img src="/Content/Content/Content/Content/../../../../upload/image/201607/J16224742-598.gif" alt="复制代码"/></a></span></p><h1 style="margin: 10px 0px 5px; font-size: 26px; font-family: verdana, sans-serif; white-space: normal; background-color: rgb(0, 0, 0);"><span style="color: rgb(255, 255, 255);">十三、缓存依赖总结</span></h1><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　缓存依赖主要有如下技术点</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　Dependency依赖：.Net中支持两种依赖：CacheDependency和SqlDependency(两者都是Dependency的子类)。从.Net2.0开始，CacheDependency不再是密封的，而是可以继承的。<br/>　　 &nbsp; &nbsp; &nbsp;┠CacheDependency：表示对文件或者目录的依赖<br/>　　 &nbsp; &nbsp; &nbsp;┠SqlDependency：表示基于SQL数据库的依赖</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　过期时间：过期时间分绝对过期时间和滑动过期时间两种。<br/>　　 &nbsp; ┠绝对过期时间：为特定时间点，类型为DateTime，如果不使用绝对过期时间，那么，使用System.Web.Caching.Cache.NoAbsoluteExpiration表示。<br/>　　 &nbsp; ┠滑动过期时间：为一个事件间隔，类型为TimeSpan，如果不使用滑动过期时间，使用System.Web.Cacheing.NoSlidingExpiration表示。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　删除通知：.Net提供了一个机制，当被缓存的数据从内存中移除的时候，可以提供一个通知机制，来回调用户定义的方法，方法必须符合CacheItemRemoveCallback委托的定义。该委托定义如下：</p><pre style="margin-top: 0px; margin-bottom: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important;">public&nbsp;delegate&nbsp;void&nbsp;CacheItemRemoveCallback(string&nbsp;key,Object&nbsp;value,CacheItemRemovedReason&nbsp;reason)</pre><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　其中，CacheItemRemoveReason为缓存项被移除的原因。CacheItemRemovedReason是一个枚举类型，定义了如下原因：</p><ol style="padding-left: 40px; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>DependencyChange：由于依赖发生变化被移除；</p></li><li><p>Expired：由于过期被移除；</p></li><li><p>Removed：由于调用Insert插入一个同名的缓存项或者调用Remove失效被移除；</p></li><li><p>Underused：系统移除；</p></li></ol><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">注意：</p><ul style="margin-left: 30px; padding-left: 0px; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>回调的时机是不可预知的，不能假定回调发生时，回调方法的执行线程存在HttpContext的上下文，为了在没有请求上下文的时候取得对Cache对象的引用，可以通过HttpRuntime的Cache属性来使用应用程序的Cache。</p></li><li><p>不能在页面上使用实例方法来作为回调方法，当在页面上使用回调方法时，由于指向回调方法的引用会阻止垃圾回收机制，因此会造成内存很快耗光。</p></li><li><p>一般通过在自定义类的静态方法实现回调方法，或者使用页面对象的静态方法的实现。</p></li></ul><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">PS:　　</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　1、 CacheDependency是AggregateCacheDependency和SqlCacheDependency的父类。主要用于在应用程序数据缓存对象与文件、缓存键、文件或缓存键的数组或另外一个CacheDependency对象之间建立依赖关系。CacheDependency监视依赖关系比便在任何对象更改时自动移除缓存对象。CacheDependency可以监测一组(到文件或目录的)文件路径的更改情况。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　2、 AggregateCacheDependency主要用于实现聚合缓存依赖。如一笔数据同时对两个表进行缓存依赖，一旦其中任何一个表数据更改缓存将失效。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　3、 SqlCacheDependency将应用程序数据缓存对象、页面输出缓存、数据源控件等与指定SQL Server数据库表或Sql Server 2005 查询结果之间建立缓存依赖关系，在表发生更改(Sql Server 2005 行级别更改)时，自动从缓存中删除和重新添加与该表关联的缓存对象。一般而言：</p><ul style="margin-left: 30px; padding-left: 0px; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);" class=" list-paddingleft-2"><li><p>SqlCacheDependency (SqlCommand) 用于SQL SERVER 2005</p></li><li><p>SqlCacheDependency (数据库名, 表名) 用于SQL SERVER 7.0/2000</p></li></ul><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　有以下几条缓存数据的规则。:<br/>　　第一，数据可能会被频繁的被使用，这种数据可以缓存。&nbsp;<br/>　　第二，数据的访问频率非常高，或者一个数据的访问频率不高，但是它的生存周期很长(很少变动)，这样的数据最好也缓存起来。&nbsp;<br/>　　第三，是一个常常被忽略的问题，有时候我们缓存了太多数据，通常在一台X86的机子上，如果你要缓存的数据超过800M的话，就会出现内存溢出的错误。所以说缓存是有限的。换名话说，你应该估计缓存集的大小，把缓存集的大小限制在10以内，否则它可能会出问题。在Asp.net中，如果缓存过大的话也会报内存溢出错误，特别是如果缓存大的DataSet对象的时候。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　你应该认真分析你的程序。根据实际情况来看哪里该用，哪里不该用。如：Cache用得过多也会增大服务器的压力。整页输出缓存，又会影响数据的更新。 如果真的需要缓存很大量的数据，可以考虑静态技术。</p><p style="margin: 10px auto; font-family: verdana, sans-serif; font-size: 13px; line-height: 19.5px; white-space: normal; background-color: rgb(255, 255, 255);">　　<strong><span style="color: rgb(255, 0, 0);">CacheDependency还支持【嵌套】，即：CacheDependency的构造函数中支持传入其它的CacheDependency实例，这样可以构成一种非常复杂的树状依赖关系。</span></strong></p><p><br/></p>
                        </code>
                        </pre>
                        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
                        <!-- UY BEGIN -->
                        <div id="uyan_frame"></div>
                        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2113268"></script>
                        <!-- UY END -->
                    </div>
                </div>
                <div id="footerInnerSeparator"></div>
            </div>
        </div>
        <div id="footerOuterSeparator"></div>
    </div>
    <br /><br /><br />
    <script src="../../js/jquery-1.9.1.js"></script>
    <script>
        window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": $("#divMain pre code").text(), "bdMini": "2", "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {}, "image": { "viewList": ["qzone", "tsina", "tqq", "renren", "weixin"], "viewText": "分享到：", "viewSize": "16" }, "selectShare": { "bdContainerClass": null, "bdSelectMiniList": ["qzone", "tsina", "tqq", "renren", "weixin"] } }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];
    </script>
</body>
</html>